pipeline {
    agent any
    
    stages {
        stage('æ¸¬è©¦é€£æ¥') {
            steps {
                echo 'ğŸ” æ¸¬è©¦åŸºæœ¬é€£æ¥...'
                sh '''
                    echo "=== ç’°å¢ƒæª¢æŸ¥ ==="
                    echo "Jenkins ç‰ˆæœ¬: $(java -version 2>&1 | head -1)"
                    echo "ç•¶å‰æ™‚é–“: $(date)"
                    echo "å·¥ä½œç›®éŒ„: $(pwd)"
                    echo "æª”æ¡ˆåˆ—è¡¨:"
                    ls -la
                '''
            }
        }
        
        stage('æª¢æŸ¥ Dashboard æª”æ¡ˆ') {
            steps {
                echo 'ğŸ“Š æª¢æŸ¥ Dashboard æª”æ¡ˆ...'
                sh '''
                    echo "=== Dashboard æª”æ¡ˆæª¢æŸ¥ ==="
                    if [ -f "dashboard.json" ]; then
                        echo "âœ… dashboard.json å­˜åœ¨"
                        echo "æª”æ¡ˆå¤§å°: $(wc -c < dashboard.json) bytes"
                        echo "JSON æ ¼å¼æª¢æŸ¥:"
                        python -m json.tool dashboard.json > /dev/null && echo "âœ… JSON æ ¼å¼æ­£ç¢º" || echo "âŒ JSON æ ¼å¼éŒ¯èª¤"
                    else
                        echo "âŒ dashboard.json ä¸å­˜åœ¨"
                    fi
                '''
            }
        }
        
        stage('æ¸¬è©¦ Grafana é€£æ¥') {
            steps {
                echo 'ğŸŒ æ¸¬è©¦ Grafana é€£æ¥...'
                script {
                    try {
                        def response = sh(
                            script: 'curl -s -o /dev/null -w "%{http_code}" https://xsong.grafana.net',
                            returnStdout: true
                        )
                        echo "Grafana é€£æ¥ç‹€æ…‹: ${response}"
                    } catch (Exception e) {
                        echo "âŒ Grafana é€£æ¥å¤±æ•—: ${e.getMessage()}"
                    }
                }
            }
        }
    }
    
    post {
        always {
            echo 'ğŸ§¹ æ¸¬è©¦å®Œæˆ'
        }
    }
}
